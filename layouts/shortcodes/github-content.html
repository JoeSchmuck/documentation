<!-- Define variables -->
{{ $path := .Get "path" }}
{{ $localBaseDir := "Apps_Temp" }}
{{ $localFilePath := printf "%s/%s" $localBaseDir $path }}

<!-- Debugging: Print the local file path -->
<p>Debug: Local file path - {{ $localFilePath }}</p>

<!-- Initialize file content -->
{{ $fileContent := "" }}
{{ $jsonData := nil }}

<!-- Check if the file exists locally -->
{{ if fileExists $localFilePath }}
  <!-- Read the file from the local directory -->
  {{ $fileContent = readFile $localFilePath }}
  {{ $jsonData = transform.Unmarshal $fileContent }}
{{ else }}
  <!-- Handle the case where the file does not exist -->
  <p>Error: File does not exist at {{ $localFilePath }}</p>
  {{ return }}
{{ end }}

<!-- Extract the first key dynamically -->
{{ $firstKey := "" }}
{{ range $key, $value := $jsonData }}
  {{ $firstKey = $key }}
  {{ break }}
{{ end }}
{{ $versionData := index $jsonData $firstKey }}

<!-- Extract specific values from the JSON -->
{{ $icon := $versionData.app_metadata.icon }}
{{ $name := $versionData.app_metadata.name }}
{{ $descr := $versionData.app_metadata.description }}

<!-- Render the content -->
<div class="apps-docs-sections">
  <!-- First Card -->
  <div class="section-box">
    <div class="box-image">
      <img class="app-card-img" src="{{ $icon }}" aria-label="{{ $name }} Logo">
    </div>
    <div class="section-tab-content ixprods">
      <b style="justify-content:center;font-size:1.5rem;font-weight:600;">{{ $versionData.app_metadata.title }}</b><br>
      <a class="truenas-appbutton" href="https://www.truenas.com/docs/truenasapps/">Get Started with Apps!</a><br>
      <div class="app-info">
        <small>App Version: <b>{{ $versionData.app_metadata.app_version }}</b>
        {{ with $versionData.app_metadata.home }}
          {{ if strings.HasPrefix . "https://github.com" }}
          (<a href="{{ . }}/releases/" target="_blank">Releases</a>)
          {{ end }}
        {{ end }}
        <br>
        Version: <b>{{ $versionData.version }}</b> (<a href="https://github.com/truenas/apps/blame/master/{{ $path }}" target="_blank">Updated {{ substr $versionData.last_update 0 10 }}</a>)<br>
        {{ with $versionData.app_metadata.keywords }}
          Keywords: {{ delimit . ", " }}<br>
        {{ end }}
        Train: {{ $versionData.app_metadata.train }}<br>
        Home Page: <a href="{{ $versionData.app_metadata.home }}" target="_blank">{{ $versionData.app_metadata.home }}</a><br>
        </small>
      </div>
    </div>
  </div>
</div>

<!-- Expandable Section -->
<br>
<details>
  <summary>App Metadata (Raw File)</summary>
  <pre><code>{{ $fileContent }}</code></pre>
</details>
<br>
<hr>